<template>
  <div class="response-template-container">
    <div v-html="streamedContent" class="streamed-content"></div>
  </div>
</template>

<script>
export default {
  name: 'ResponseTemplate',
  data() {
    return {
      fullContent: `
             <div class="q-pa-md">

          <!-- âœ… ì „ì²´ ì í¬ ë¦¬ìŠ¤íŠ¸ -->
          <div class="q-mb-md">
            <div class="bg-grey-3 text-black q-pa-sm text-h6">ğŸ¢ ì „ì²´ ì í¬ í˜„í™©</div>

            <!-- 1) ê¸´ì‹œì´ˆì  -->
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ê¸´ì‹œì´ˆì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 37,939,133ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -8,820,099ì—” (-18.89% ê°ì†Œ)
                </p>
                <p>
                  &emsp;<strong>ë°©ë¬¸ì ìˆ˜</strong>: 16.1ë§Œëª… (-4.19% ê°ì†Œ), ì˜í–¥: <span class="text-negative">-33bps</span><br>
                  &emsp;<strong>êµ¬ë§¤ ì „í™˜ìœ¨</strong>: 60.23% (-600bps), ì˜í–¥: <span class="text-negative">-87bps</span><br>
                  &emsp;<strong>í‰ê·  ë‹¨ê°€</strong>: 390ì—” (-6.88% í•˜ë½), ì˜í–¥: <span class="text-negative">-56bps</span>
                </p>
              </div>
              <div class="card-section bg-grey-2">
                <p>&emsp;<strong>í–¥í›„ ì¡°ì¹˜ì‚¬í•­:</strong> êµ¬ë§¤ ì „í™˜ìœ¨ í–¥ìƒì„ ìœ„í•œ ëŒ€ì±… í•„ìš”.</p>
              </div>
            </div>

            <!-- 2) ì¸ í‚¤ì‹œë§ˆì  -->
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ì¸ í‚¤ì‹œë§ˆì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 85,840,701ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -5,105,125ì—” (-5.61% ê°ì†Œ)
                </p>
                <p>
                  &emsp;<strong>ë°©ë¬¸ì ìˆ˜</strong>: 32.8ë§Œëª… (-5.92% ê°ì†Œ), ì˜í–¥: <span class="text-negative">-108bps</span><br>
                  &emsp;<strong>êµ¬ë§¤ ì „í™˜ìœ¨</strong>: 66.59% (+282bps), ì˜í–¥: <span class="text-positive">+76bps</span><br>
                  &emsp;<strong>í‰ê·  ë‹¨ê°€</strong>: 393ì—” (-3.92% í•˜ë½), ì˜í–¥: <span class="text-negative">-70bps</span>
                </p>
              </div>
              <div class="card-section bg-grey-2">
                <p>&emsp;<strong>í–¥í›„ ì¡°ì¹˜ì‚¬í•­:</strong> ë°©ë¬¸ì ìˆ˜ ê°ì†Œ ëŒ€ì‘ í•„ìš”.</p>
              </div>
            </div>

            <!-- 3) ë¡¯í°ê¸°ì  -->
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ë¡¯í°ê¸°ì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 41,940,315ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -6,902,114ì—” (-14.13% ê°ì†Œ)
                </p>
                <p>
                  &emsp;<strong>ë°©ë¬¸ì ìˆ˜</strong>: 16.2ë§Œëª… (-4.67% ê°ì†Œ), ì˜í–¥: <span class="text-negative">-41bps</span><br>
                  &emsp;<strong>êµ¬ë§¤ ì „í™˜ìœ¨</strong>: 61.80% (-494.78bps), ì˜í–¥: <span class="text-negative">-73bps</span><br>
                  &emsp;<strong>í‰ê·  ë‹¨ê°€</strong>: 418ì—” (-2.71% í•˜ë½), ì˜í–¥: <span class="text-negative">-23bps</span>
                </p>
              </div>
              <div class="card-section bg-grey-2">
                <p>&emsp;<strong>í–¥í›„ ì¡°ì¹˜ì‚¬í•­:</strong> êµ¬ë§¤ì „í™˜ìœ¨ í–¥ìƒ í•„ìš”.</p>
              </div>
            </div>
          </div>

          <!-- âœ… Top 3 ì í¬ -->
          <div class="q-mb-md">
            <div class="bg-green-3 text-black q-pa-sm text-h6">ğŸš€ Top 3 ì í¬ (ë§¤ì¶œ ê°ì†Œìœ¨ ì ìŒ)</div>
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ì¸ í‚¤ì‹œë§ˆì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 85,840,701ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -5,105,125ì—” (-5.61% ê°ì†Œ)
                </p>
              </div>
            </div>
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ë„ìš”ìŠ¤ì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 84,860,736ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -3,493,874ì—” (-3.95% ê°ì†Œ)
                </p>
              </div>
            </div>
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ì‹œì˜¤ë„ë©”ì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 41,722,166ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -1,412,676ì—” (-3.28% ê°ì†Œ)
                </p>
              </div>
            </div>
          </div>

          <!-- âœ… Bottom 3 ì í¬ -->
          <div class="q-mb-md">
            <div class="bg-red-3 text-black q-pa-sm text-h6">âš ï¸ Bottom 3 ì í¬ (ë§¤ì¶œ ê°ì†Œìœ¨ í¼)</div>
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ê¸´ì‹œì´ˆì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 37,939,133ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -8,820,099ì—” (-18.89% ê°ì†Œ)
                </p>
              </div>
            </div>
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ë¡¯í°ê¸°ì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 41,940,315ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -6,902,114ì—” (-14.13% ê°ì†Œ)
                </p>
              </div>
            </div>
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ë™ìš´ì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 80,536,046ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -10,249,272ì—” (-11.29% ê°ì†Œ)
                </p>
              </div>
            </div>
          </div>

        </div>
      `,
      streamedContent: '',
      tokens: [],
      timer: null,
      currentIndex: 0,
    };
  },
  mounted() {
    this.prepareTokens();
    this.startStreaming();
  },
  beforeDestroy() {
    if (this.timer) clearTimeout(this.timer);
  },
  methods: {
    prepareTokens() {
      const regex = /(<[^>]+>|\s+|[^<\s]+)/g;
      this.tokens = this.fullContent.match(regex);
    },
    startStreaming() {
      const streamNextToken = () => {
        if (this.currentIndex < this.tokens.length) {
          this.streamedContent += this.tokens[this.currentIndex++];
          //console.log(this.streamedContent);
          this.$emit('content-updated');
          const delay = 15 + Math.random() * 30; // ë” ìì—°ìŠ¤ëŸ¬ìš´ ì†ë„
          this.timer = setTimeout(streamNextToken, delay);
        } else {
          this.$emit('update:isRunning', false);
        }
      };
      streamNextToken();
    }
  }
};
</script>

<style scoped>
.streamed-content {
  white-space: normal;
}
.response-template-container {
  padding: 16px;
}
</style>
