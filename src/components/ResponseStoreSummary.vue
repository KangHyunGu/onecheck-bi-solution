<template>
  <div class="response-template-container">
    <!-- ìŠ¤íŠ¸ë¦¬ë°ëœ HTMLì´ í‘œì‹œë  ì˜ì—­ -->
    <div v-html="streamedContent" class="streamed-content"></div>
  </div>
</template>

<script>
export default {
  name: 'ResponseTemplate',
  data() {
    return {
      /**
       * (1) ë©€í‹°ë¼ì¸ìœ¼ë¡œ ì‘ì„±ëœ HTML ë¬¸ìì—´
       *  - í…Œì´ë¸”ì„ ì—†ì• ê³ , í…ìŠ¤íŠ¸Â·ì¤„ë°”ê¿ˆë§Œìœ¼ë¡œ ì í¬ ì •ë³´ë¥¼ í‘œì‹œ
       */
      fullContent: `
        <div class="q-pa-md">

          <!-- âœ… ì „ì²´ ì í¬ ë¦¬ìŠ¤íŠ¸ -->
          <div class="q-mb-md">
            <div class="bg-grey-3 text-black q-pa-sm text-h6">ğŸ¢ ì „ì²´ ì í¬ í˜„í™©</div>

            <!-- 1) ê¸´ì‹œì´ˆì  -->
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ê¸´ì‹œì´ˆì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 37,939,133ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -8,820,099ì—” (-18.89% ê°ì†Œ)
                </p>
                <p>
                  &emsp;<strong>ë°©ë¬¸ì ìˆ˜</strong>: 16.1ë§Œëª… (-4.19% ê°ì†Œ), ì˜í–¥: <span class="text-negative">-33bps</span><br>
                  &emsp;<strong>êµ¬ë§¤ ì „í™˜ìœ¨</strong>: 60.23% (-600bps), ì˜í–¥: <span class="text-negative">-87bps</span><br>
                  &emsp;<strong>í‰ê·  ë‹¨ê°€</strong>: 390ì—” (-6.88% í•˜ë½), ì˜í–¥: <span class="text-negative">-56bps</span>
                </p>
              </div>
              <div class="card-section bg-grey-2">
                <p>&emsp;<strong>í–¥í›„ ì¡°ì¹˜ì‚¬í•­:</strong> êµ¬ë§¤ ì „í™˜ìœ¨ í–¥ìƒì„ ìœ„í•œ ëŒ€ì±… í•„ìš”.</p>
              </div>
            </div>

            <!-- 2) ì¸ í‚¤ì‹œë§ˆì  -->
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ì¸ í‚¤ì‹œë§ˆì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 85,840,701ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -5,105,125ì—” (-5.61% ê°ì†Œ)
                </p>
                <p>
                  &emsp;<strong>ë°©ë¬¸ì ìˆ˜</strong>: 32.8ë§Œëª… (-5.92% ê°ì†Œ), ì˜í–¥: <span class="text-negative">-108bps</span><br>
                  &emsp;<strong>êµ¬ë§¤ ì „í™˜ìœ¨</strong>: 66.59% (+282bps), ì˜í–¥: <span class="text-positive">+76bps</span><br>
                  &emsp;<strong>í‰ê·  ë‹¨ê°€</strong>: 393ì—” (-3.92% í•˜ë½), ì˜í–¥: <span class="text-negative">-70bps</span>
                </p>
              </div>
              <div class="card-section bg-grey-2">
                <p>&emsp;<strong>í–¥í›„ ì¡°ì¹˜ì‚¬í•­:</strong> ë°©ë¬¸ì ìˆ˜ ê°ì†Œ ëŒ€ì‘ í•„ìš”.</p>
              </div>
            </div>

            <!-- 3) ë¡¯í°ê¸°ì  -->
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ë¡¯í°ê¸°ì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 41,940,315ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -6,902,114ì—” (-14.13% ê°ì†Œ)
                </p>
                <p>
                  &emsp;<strong>ë°©ë¬¸ì ìˆ˜</strong>: 16.2ë§Œëª… (-4.67% ê°ì†Œ), ì˜í–¥: <span class="text-negative">-41bps</span><br>
                  &emsp;<strong>êµ¬ë§¤ ì „í™˜ìœ¨</strong>: 61.80% (-494.78bps), ì˜í–¥: <span class="text-negative">-73bps</span><br>
                  &emsp;<strong>í‰ê·  ë‹¨ê°€</strong>: 418ì—” (-2.71% í•˜ë½), ì˜í–¥: <span class="text-negative">-23bps</span>
                </p>
              </div>
              <div class="card-section bg-grey-2">
                <p>&emsp;<strong>í–¥í›„ ì¡°ì¹˜ì‚¬í•­:</strong> êµ¬ë§¤ì „í™˜ìœ¨ í–¥ìƒ í•„ìš”.</p>
              </div>
            </div>
          </div>

          <!-- âœ… Top 3 ì í¬ -->
          <div class="q-mb-md">
            <div class="bg-green-3 text-black q-pa-sm text-h6">ğŸš€ Top 3 ì í¬ (ë§¤ì¶œ ê°ì†Œìœ¨ ì ìŒ)</div>
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ì¸ í‚¤ì‹œë§ˆì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 85,840,701ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -5,105,125ì—” (-5.61% ê°ì†Œ)
                </p>
              </div>
            </div>
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ë„ìš”ìŠ¤ì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 84,860,736ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -3,493,874ì—” (-3.95% ê°ì†Œ)
                </p>
              </div>
            </div>
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ì‹œì˜¤ë„ë©”ì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 41,722,166ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -1,412,676ì—” (-3.28% ê°ì†Œ)
                </p>
              </div>
            </div>
          </div>

          <!-- âœ… Worse 3 ì í¬ -->
          <div class="q-mb-md">
            <div class="bg-red-3 text-black q-pa-sm text-h6">âš ï¸ Worse 3 ì í¬ (ë§¤ì¶œ ê°ì†Œìœ¨ í¼)</div>
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ê¸´ì‹œì´ˆì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 37,939,133ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -8,820,099ì—” (-18.89% ê°ì†Œ)
                </p>
              </div>
            </div>
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ë¡¯í°ê¸°ì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 41,940,315ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -6,902,114ì—” (-14.13% ê°ì†Œ)
                </p>
              </div>
            </div>
            <div class="store-card q-mb-md">
              <div class="card-section">
                <div class="text-h6">ë™ìš´ì </div>
                <p>
                  &emsp;<strong>4ì›” ë§¤ì¶œ</strong>: 80,536,046ì—”<br>
                  &emsp;<strong>ì „ì›” ëŒ€ë¹„</strong>: -10,249,272ì—” (-11.29% ê°ì†Œ)
                </p>
              </div>
            </div>
          </div>

        </div>
      `,
      streamedContent: '', // ìŠ¤íŠ¸ë¦¬ë°ë˜ì–´ í™”ë©´ì— í‘œì‹œë  HTML
      currentIndex: 0,     // í˜„ì¬ê¹Œì§€ ë…¸ì¶œí•œ ë¬¸ìì—´ì˜ ì¸ë±ìŠ¤
      timer: null,         // setInterval íƒ€ì´ë¨¸ ì°¸ì¡°
    };
  },
  mounted() {
    // (2) ë©€í‹°ë¼ì¸ ë¬¸ìì—´ì—ì„œ ë¶ˆí•„ìš”í•œ ì¤„ë°”ê¿ˆ/ê³µë°±ì„ ì •ë¦¬
    this.fullContent = this.fullContent.replace(/\s*\n\s*/g, ' ').trim();
    console.log(this.fullContent);
    // (3) ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘
    this.startStreaming();
  },
  beforeDestroy() {
    if (this.timer) {
      clearInterval(this.timer);
    }
  },
  methods: {
    /**
     * 20ms ê°„ê²©ìœ¼ë¡œ í•œ ê¸€ìì”© streamedContentì— ì¶”ê°€í•˜ì—¬
     * LLM ìŠ¤íŠ¸ë¦¬ë° íš¨ê³¼ì²˜ëŸ¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
     */
    startStreaming() {
      this.timer = setInterval(() => {
        if (this.currentIndex < this.fullContent.length) {
          this.streamedContent += this.fullContent[this.currentIndex];
          this.currentIndex++;
          this.$emit('content-updated'); // ğŸ”¥ ìë™ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë°œìƒ
        } else {
          clearInterval(this.timer);
        }
      }, 20);
    }
  }
};
</script>

<style scoped>
/* (4) ìŠ¤íŠ¸ë¦¬ë° ì˜ì—­ì˜ white-space ì„¤ì • */
.streamed-content {
  white-space: normal; /* HTML íƒœê·¸ëŠ” í•´ì„, íƒœê·¸ ì‚¬ì´ ê³µë°±ì€ ìë™ ì¡°ì • */
}

/* í•„ìš” ì‹œ .response-template-containerì— ì¶”ê°€ ìŠ¤íƒ€ì¼ ì ìš© */
.response-template-container {
  /* ì˜ˆ: padding: 16px; */
}

/* Quasar-like ìŠ¤íƒ€ì¼(ì˜ˆì‹œ) */
.q-pa-md {
  padding: 16px;
}
.q-mb-md {
  margin-bottom: 16px;
}
.bg-grey-3 {
  background-color: #e0e0e0;
}
.bg-grey-2 {
  background-color: #eeeeee;
}
.bg-green-3 {
  background-color: #a5d6a7;
}
.bg-red-3 {
  background-color: #ef9a9a;
}
.text-black {
  color: black;
}
.text-h6 {
  font-size: 1.25rem;
  font-weight: bold;
}
.q-pa-sm {
  padding: 8px;
}

/* store-card, card-section ë“± ì„ì˜ í´ë˜ìŠ¤ */
.store-card {
  border: 1px solid #ccc;
  margin-bottom: 16px;
}
.card-section {
  padding: 8px;
}

/* ì¦ê°ë¥ ì— ë”°ë¥¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì˜ˆì‹œ */
.text-negative {
  color: red;
}
.text-positive {
  color: green;
}
</style>
